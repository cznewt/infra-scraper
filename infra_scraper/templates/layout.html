{% extends "base.html" %}

{% block page_header %}
Layout {{ name }}
{% endblock %}

{% block content %}

<div class="row">
  <div class="col s12 m9">
    <div class="card">
      <div class="card-content">
        <span class="card-title">Endpoint {{ name }}</span>
        <div id="visual-preloader-wrapper">
          {% include "partials/preloader.html" %}
          <div id="visual-layout-wrapper">
            <div id="visual-layout"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col s12 m3">
    <div class="card">
      <div class="card-content">
        <span class="card-title">Topology</span>
        <ul class="collection">
          <li class="collection-item">Visual Layout<span class="badge">{{ layout|capitalize }}</span></li>
          <li class="collection-item">Endpoint Type<span class="badge">{{ config.kind|capitalize }}</span></li>
          <li class="collection-item">Resources<span class="badge" id="countResources">N/A</span></li>
          <li class="collection-item">Relations<span class="badge" id="countRelations">N/A</span></li>
        </ul>
      </div>
      <div class="card-action right-align">
        <a href="/">Close</a>
        <a href="./{{ layout }}">Update</a>
      </div>
    </div>
    <div class="card">
      <div class="card-content">
        <span class="card-title">Resource</span>
        <div id="resource-detail">
          None selected
        <div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>

var data_source = "/api/{{ name }}";
var selector = '#visual-layout';

document.addEventListener("DOMContentLoaded", function(event) {
  console.log('DOM content loaded.');
  d3.json(data_source, function(data) {
    console.log('Plot data loaded.');
    d3.select("#visual-preloader-wrapper .main-loader").style("display", "none");
    $("#countResources").html(Object.keys(data.resources).length);
    $("#countRelations").html(data.relations.length);
    HivePlot.init(selector, data);
  });
});

</script>
{% endblock %}
